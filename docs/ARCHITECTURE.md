# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

Stockelper Airflow ì‹œìŠ¤í…œì˜ ì „ì²´ ì•„í‚¤í…ì²˜ì™€ ì„¤ê³„ ê²°ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“ ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Stockelper Ecosystem                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Airflow    â”‚    â”‚    Neo4j     â”‚    â”‚   MongoDB    â”‚  â”‚
â”‚  â”‚  (21003)     â”‚â—„â”€â”€â–ºâ”‚ (21004/5)    â”‚â—„â”€â”€â–ºâ”‚   Atlas      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                         â–²          â”‚
â”‚         â”‚                                         â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    stockelper network                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
stockelper-airflow/
â”œâ”€â”€ dags/                           # Airflow DAG ì •ì˜
â”‚   â”œâ”€â”€ stock_report_crawler_dag.py # ë¦¬í¬íŠ¸ í¬ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ competitor_crawler_dag.py   # ê²½ìŸì‚¬ í¬ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ dart_disclosure_collection_dag.py # DART ê³µì‹œ(ì—„ì„ ëœ) ìˆ˜ì§‘
â”‚   â”œâ”€â”€ dart_disclosure_collection_backfill_dag.py # DART ê³µì‹œ(ì—„ì„ ëœ) ë°±í•„
â”‚   â”œâ”€â”€ dart_event_extraction_backfill_dag.py # DART ì´ë²¤íŠ¸/ê°ì„± ì¶”ì¶œ ë°±í•„
â”‚   â””â”€â”€ log_cleanup_dag.py          # ë¡œê·¸ ì •ë¦¬
â”‚
â”œâ”€â”€ modules/                        # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ common/                     # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ logging_config.py      # í†µí•© ë¡œê¹… ì„¤ì •
â”‚   â”œâ”€â”€ report_crawler/             # ë¦¬í¬íŠ¸ í¬ë¡¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ stock_report_crawler.py
â”‚   â””â”€â”€ company_crawler/            # ê¸°ì—… í¬ë¡¤ëŸ¬
â”‚       â””â”€â”€ compete_company_crawler.py
â”‚
â”œâ”€â”€ config/                         # ì„¤ì • íŒŒì¼
â”‚   â””â”€â”€ airflow.cfg                 # Airflow ì„¤ì •
â”‚
â”œâ”€â”€ scripts/                        # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ deploy.sh                   # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ setup_network.sh            # ë„¤íŠ¸ì›Œí¬ ì„¤ì •
â”‚   â”œâ”€â”€ cleanup_logs.sh             # ë¡œê·¸ ì •ë¦¬
â”‚   â””â”€â”€ stop.sh                     # ì„œë¹„ìŠ¤ ì¤‘ì§€
â”‚
â”œâ”€â”€ docs/                           # ë¬¸ì„œ
â”‚   â”œâ”€â”€ QUICKSTART.md               # ë¹ ë¥¸ ì‹œì‘
â”‚   â”œâ”€â”€ ARCHITECTURE.md             # ì´ ë¬¸ì„œ
â”‚   â”œâ”€â”€ DEVELOPMENT.md              # ê°œë°œ ê°€ì´ë“œ
â”‚   â”œâ”€â”€ TROUBLESHOOTING.md          # ë¬¸ì œ í•´ê²°
â”‚   â”œâ”€â”€ API_REFERENCE.md            # API ë ˆí¼ëŸ°ìŠ¤
â”‚   â”œâ”€â”€ LOGGING_GUIDE.md            # ë¡œê¹… ê°€ì´ë“œ
â”‚   â”œâ”€â”€ ADMIN_USER_SETUP.md         # Admin ì„¤ì •
â”‚   â”œâ”€â”€ DOCKER_COMPOSE_CHANGES.md   # Docker ë³€ê²½ì‚¬í•­
â”‚   â””â”€â”€ LOG_MANAGEMENT.md           # ë¡œê·¸ ê´€ë¦¬
â”‚
â”œâ”€â”€ docker-compose.yml              # Docker Compose ì„¤ì •
â”œâ”€â”€ Dockerfile                      # Docker ì´ë¯¸ì§€ ì •ì˜
â”œâ”€â”€ requirements.txt                # Python ì˜ì¡´ì„±
â”œâ”€â”€ .env.example                    # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â”œâ”€â”€ .gitignore                      # Git ì œì™¸ íŒŒì¼
â”œâ”€â”€ LICENSE                         # ë¼ì´ì„ ìŠ¤
â””â”€â”€ README.md                       # í”„ë¡œì íŠ¸ ê°œìš”
```

## ğŸ”„ ë°ì´í„° íë¦„

### 1. Stock Report Crawler

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scheduler  â”‚ (ë§¤ì¼ 00:00 UTC)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  stock_report_crawler_dag                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  1. check_mongodb_connection                â”‚
â”‚     â””â”€â–º MongoDB ì—°ê²° í…ŒìŠ¤íŠ¸                 â”‚
â”‚                                             â”‚
â”‚  2. crawl_stock_report                      â”‚
â”‚     â”œâ”€â–º StockReportCrawler ì´ˆê¸°í™”           â”‚
â”‚     â”œâ”€â–º Selenium WebDriver ì„¤ì •             â”‚
â”‚     â”œâ”€â–º ê¸ˆìœµ ì›¹ì‚¬ì´íŠ¸ ì ‘ì†                  â”‚
â”‚     â”œâ”€â–º ë¦¬í¬íŠ¸ ë°ì´í„° ì¶”ì¶œ                  â”‚
â”‚     â””â”€â–º MongoDBì— ì €ì¥ (upsert)             â”‚
â”‚                                             â”‚
â”‚  3. report_results                          â”‚
â”‚     â””â”€â–º í¬ë¡¤ë§ í†µê³„ ë¡œê¹…                    â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MongoDB   â”‚
â”‚  (Atlas)    â”‚
â”‚             â”‚
â”‚ Collection: â”‚
â”‚ stock_reportsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Competitor Crawler

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scheduler  â”‚ (ë§¤ì¼ 00:00 UTC)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  competitor_crawler_dag                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  crawl_competitor_companies                 â”‚
â”‚     â”œâ”€â–º FinanceDataReaderë¡œ ì¢…ëª© ì½”ë“œ ì¡°íšŒ  â”‚
â”‚     â”œâ”€â–º Wisereport API í˜¸ì¶œ                 â”‚
â”‚     â”œâ”€â–º ê²½ìŸì‚¬ ë°ì´í„° íŒŒì‹±                  â”‚
â”‚     â””â”€â–º MongoDBì— ì €ì¥ (upsert)             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MongoDB   â”‚
â”‚  (Atlas)    â”‚
â”‚             â”‚
â”‚ Collection: â”‚
â”‚ competitors â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Log Cleanup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scheduler  â”‚ (ë§¤ì¼ 02:00 UTC)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  log_cleanup_dag                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  1. get_log_statistics                      â”‚
â”‚     â””â”€â–º í˜„ì¬ ë¡œê·¸ ìƒíƒœ í™•ì¸                 â”‚
â”‚                                             â”‚
â”‚  2. cleanup_old_logs                        â”‚
â”‚     â”œâ”€â–º 7ì¼ ì´ìƒ ëœ ë¡œê·¸ íŒŒì¼ ì‚­ì œ          â”‚
â”‚     â””â”€â–º ë¹ˆ ë””ë ‰í† ë¦¬ ì •ë¦¬                    â”‚
â”‚                                             â”‚
â”‚  3. get_log_statistics_after_cleanup        â”‚
â”‚     â””â”€â–º ì •ë¦¬ í›„ ìƒíƒœ í™•ì¸                   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ³ Docker ì•„í‚¤í…ì²˜

### ì»¨í…Œì´ë„ˆ êµ¬ì„±

```yaml
services:
  airflow:
    image: apache/airflow:2.10.4-python3.12
    container_name: stockelper-airflow
    ports:
      - "21003:8080"
    networks:
      - stockelper
    volumes:
      - airflow_logs:/opt/airflow/logs
      - airflow_db:/opt/airflow
```

### ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     stockelper (bridge network)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  stockelper-airflow          â”‚  â”‚
â”‚  â”‚  IP: 172.18.0.x              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  stockelper-neo4j            â”‚  â”‚
â”‚  â”‚  IP: 172.18.0.y              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì **:
- ì„œë¹„ìŠ¤ ê°„ ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ í†µì‹  ê°€ëŠ¥
- ê²©ë¦¬ëœ ë„¤íŠ¸ì›Œí¬ í™˜ê²½
- ì™¸ë¶€ ì ‘ê·¼ ì œì–´ ìš©ì´

## ğŸ’¾ ë°ì´í„° ì €ì¥ì†Œ

### MongoDB Collections

#### 1. stock_reports

```javascript
{
  "_id": ObjectId("..."),
  "date": "2025-10-12",
  "company": "ì‚¼ì„±ì „ì",
  "code": "005930",
  "title": "2025ë…„ ì‹¤ì  ì „ë§",
  "summary": "...",
  "url": "https://...",
  "crawled_at": "2025-10-12T20:30:15.123Z"
}
```

**ì¸ë±ìŠ¤**:
```javascript
db.stock_reports.createIndex(
  { date: 1, company: 1, code: 1 },
  { unique: true }
)
```

#### 2. competitors

```javascript
{
  "_id": "005930",  // ê¸°ì—… ì½”ë“œ
  "target_company": {
    "code": "005930",
    "name": "ì‚¼ì„±ì „ì",
    "market_value": "400000000000000"
  },
  "competitors": [
    {
      "code": "000660",
      "name": "SKí•˜ì´ë‹‰ìŠ¤",
      "market_value": "80000000000000"
    }
  ],
  "last_crawled_at": "2025-10-12T20:30:15.123Z"
}
```

**ì¸ë±ìŠ¤**:
```javascript
db.competitors.createIndex({ "_id": 1 })  // ê¸°ë³¸ í‚¤
```

### SQLite (Airflow Metadata)

```
/opt/airflow/airflow.db
```

**í…Œì´ë¸”**:
- `dag`: DAG ë©”íƒ€ë°ì´í„°
- `dag_run`: DAG ì‹¤í–‰ ê¸°ë¡
- `task_instance`: Task ì‹¤í–‰ ê¸°ë¡
- `log`: Airflow ë¡œê·¸
- `variable`: Airflow ë³€ìˆ˜
- `connection`: ì—°ê²° ì •ë³´

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì²˜

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

```
.env (gitignored)
  â”œâ”€â–º MONGODB_URI (ë¯¼ê°)
  â”œâ”€â–º AIRFLOW_SECRET_KEY (ë¯¼ê°)
  â”œâ”€â–º AIRFLOW_ADMIN_PASSWORD (ë¯¼ê°)
  â””â”€â–º MONGO_DATABASE (ì¼ë°˜)
```

### ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

```
ì™¸ë¶€ â†’ 21003 (Airflow UI) â†’ stockelper network
                              â”œâ”€â–º airflow container
                              â””â”€â–º neo4j container
```

**ë³´ì•ˆ ê³„ì¸µ**:
1. **Docker ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬**: ë‚´ë¶€ í†µì‹ ë§Œ í—ˆìš©
2. **í¬íŠ¸ ë§¤í•‘**: í•„ìš”í•œ í¬íŠ¸ë§Œ ì™¸ë¶€ ë…¸ì¶œ
3. **í™˜ê²½ ë³€ìˆ˜**: ë¯¼ê° ì •ë³´ ë¶„ë¦¬
4. **Admin ì¸ì¦**: Airflow UI ì ‘ê·¼ ì œì–´

## ğŸ”„ ì‹¤í–‰ íë¦„

### ì‹œìŠ¤í…œ ì‹œì‘

```
1. docker compose up -d
   â”œâ”€â–º ë„¤íŠ¸ì›Œí¬ ìƒì„±/ì—°ê²°
   â”œâ”€â–º ë³¼ë¥¨ ë§ˆìš´íŠ¸
   â””â”€â–º ì»¨í…Œì´ë„ˆ ì‹œì‘

2. Container Startup
   â”œâ”€â–º airflow db init
   â”œâ”€â–º airflow users create
   â”œâ”€â–º airflow scheduler (ë°±ê·¸ë¼ìš´ë“œ)
   â””â”€â–º airflow webserver (í¬ê·¸ë¼ìš´ë“œ)

3. Scheduler ì‹œì‘
   â”œâ”€â–º DAG íŒŒì¼ ìŠ¤ìº”
   â”œâ”€â–º DAG íŒŒì‹±
   â””â”€â–º ìŠ¤ì¼€ì¤„ ë“±ë¡

4. Webserver ì‹œì‘
   â”œâ”€â–º Flask ì•± ì´ˆê¸°í™”
   â”œâ”€â–º UI ë Œë”ë§
   â””â”€â–º í¬íŠ¸ 8080 ë¦¬ìŠ¤ë‹
```

### DAG ì‹¤í–‰

```
1. Scheduler
   â”œâ”€â–º ìŠ¤ì¼€ì¤„ ì²´í¬
   â”œâ”€â–º DAG Run ìƒì„±
   â””â”€â–º Task íì— ì¶”ê°€

2. Executor (SequentialExecutor)
   â”œâ”€â–º Task í•˜ë‚˜ì”© ì‹¤í–‰
   â””â”€â–º ì™„ë£Œ í›„ ë‹¤ìŒ Task

3. Task ì‹¤í–‰
   â”œâ”€â–º í™˜ê²½ ì„¤ì •
   â”œâ”€â–º Python í•¨ìˆ˜ í˜¸ì¶œ
   â”œâ”€â–º ë¡œê·¸ ê¸°ë¡
   â””â”€â–º ê²°ê³¼ ì €ì¥ (XCom)

4. ì™„ë£Œ
   â”œâ”€â–º DAG Run ìƒíƒœ ì—…ë°ì´íŠ¸
   â””â”€â–º ë‹¤ìŒ ìŠ¤ì¼€ì¤„ ëŒ€ê¸°
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜

### ë¡œê¹… ê³„ì¸µ

```
Application Layer
  â”œâ”€â–º modules/common/logging_config.py
  â”‚   â””â”€â–º setup_logger()
  â”‚
  â”œâ”€â–º DAG Functions
  â”‚   â””â”€â–º logger.info/error/warning
  â”‚
  â””â”€â–º Module Classes
      â””â”€â–º logger.debug/info

Airflow Layer
  â”œâ”€â–º Task Logs
  â”‚   â””â”€â–º /opt/airflow/logs/dag_id/task_id/date/attempt.log
  â”‚
  â””â”€â–º Scheduler Logs
      â””â”€â–º /opt/airflow/logs/scheduler/

Docker Layer
  â””â”€â–º Container Logs
      â””â”€â–º docker logs stockelper-airflow
```

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```
Airflow UI
  â”œâ”€â–º DAG ì‹¤í–‰ í†µê³„
  â”œâ”€â–º Task ì„±ê³µ/ì‹¤íŒ¨ìœ¨
  â””â”€â–º ì‹¤í–‰ ì‹œê°„

XCom
  â”œâ”€â–º crawl_result
  â”œâ”€â–º deleted_files
  â””â”€â–º total_size_mb

MongoDB
  â”œâ”€â–º ë¬¸ì„œ ìˆ˜
  â””â”€â–º ì»¬ë ‰ì…˜ í¬ê¸°
```

## ğŸ”§ í™•ì¥ì„± ì„¤ê³„

### ìˆ˜í‰ í™•ì¥ (ë¯¸ë˜)

```
í˜„ì¬: SequentialExecutor
  â””â”€â–º ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤, ìˆœì°¨ ì‹¤í–‰

ë¯¸ë˜: CeleryExecutor
  â”œâ”€â–º Worker 1
  â”œâ”€â–º Worker 2
  â””â”€â–º Worker N
```

### ìˆ˜ì§ í™•ì¥

```yaml
# docker-compose.yml
services:
  airflow:
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G
```

## ğŸ¯ ì„¤ê³„ ì›ì¹™

### 1. ëª¨ë“ˆí™”
- ê° í¬ë¡¤ëŸ¬ëŠ” ë…ë¦½ì ì¸ ëª¨ë“ˆ
- ê³µí†µ ê¸°ëŠ¥ì€ `modules/common/`ì— í†µí•©
- DAGëŠ” ëª¨ë“ˆì„ ì¡°í•©í•˜ì—¬ êµ¬ì„±

### 2. ì¬ì‚¬ìš©ì„±
- ê³µí†µ ë¡œê¹… ì„¤ì •
- ê³µí†µ MongoDB ì—°ê²° ë¡œì§
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

### 3. ìœ ì§€ë³´ìˆ˜ì„±
- ëª…í™•í•œ ë””ë ‰í† ë¦¬ êµ¬ì¡°
- ìƒì„¸í•œ ë¬¸ì„œí™”
- ì¼ê´€ëœ ì½”ë”© ìŠ¤íƒ€ì¼

### 4. í™•ì¥ì„±
- ìƒˆ DAG ì¶”ê°€ ìš©ì´
- ìƒˆ í¬ë¡¤ëŸ¬ ì¶”ê°€ ìš©ì´
- Executor ë³€ê²½ ê°€ëŠ¥

### 5. ë³´ì•ˆ
- í™˜ê²½ ë³€ìˆ˜ë¡œ ë¯¼ê° ì •ë³´ ê´€ë¦¬
- ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬
- ìµœì†Œ ê¶Œí•œ ì›ì¹™

## ğŸ“š ì°¸ê³  ìë£Œ

- [Airflow Architecture](https://airflow.apache.org/docs/apache-airflow/stable/concepts/overview.html)
- [Docker Networking](https://docs.docker.com/network/)
- [MongoDB Best Practices](https://www.mongodb.com/docs/manual/administration/production-notes/)

---

ì´ ì•„í‚¤í…ì²˜ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
